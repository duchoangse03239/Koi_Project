@model KoiManagement.Models.InfoDetail

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Layout/KoiLayout.cshtml";
}

<div class="container" id="add-koi">
        <h2 id="form-title">THÊM TRẠNG THÁI MỚI</h2>
        <div class="">
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3">
                    <input type="text" class="form-control" placeholder="Kích Thước" name="Size" id="Size">
                    <label id="lblMessage_koi_size_fail" class="label-error"></label>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3">
                    <input type="text" class="form-control" placeholder="Tình Trạng Sức Khỏe" name="HeathyStatus" id="HeathyStatus">
                    <label id="lblMessage_koi_healthy_fail" class="label-error"></label>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3">
                    <textarea rows="4" type="text" class="form-control" placeholder="Mô tả" name="Description" id="Description"></textarea>
                    <label id="lblMessage_koi_description_fail" class="label-error"></label>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3">
                    @*<input id="uploadFile" type="file" accept="image/png, image/jpeg, image/gif" name="file" class="img" onchange="loadFile(event)" />*@
                    <input type="file" id="files" name="files[]" accept="image/png, image/jpeg, image/gif" multiple />

                </div>
            </div>
            <div  class="modal-footer">
                <div class="col-sm-3"></div>
                <input type="hidden" name="KoiID" value="@ViewBag.KoiID">
                <button id="btnAddKoi" class="btn btn-default">Thêm mới</button>
                <button type="button" class="btn btn-default">Đóng</button>
            </div>
        </div>
</div> 
<script>
    
        $(document).ready(function () {
            $(function () {
                $("#Weight").focus();
            });
        });

        $(document).keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == "13") {
                if (Validate()) {
                    AddKoi();
                } else {
                    return false;
                }
            }
        });
 

        $("#btnAddKoi").click(function () {
            if (Validate()) {
                AddKoi();
            } else {
                return false;
            }
        });
        function Validate() {
            var Size = $('#Size').val();
            function isPositiveNumber(Size) {
                var regex = /^[0-9 \.\,\+]+$/;
                return regex.test(Size);
            };
            if (Size == "") {
                $('#lblMessage_koi_size_fail').text("Vui lòng nhập kích thước");
                return false;
            }
            else if (!isPositiveNumber(Size)) {
                $('#lblMessage_koi_size_fail').text("Vui lòng nhập số cho kích thước của Koi!");
                return false;
            }
            return true;
        }

        function AddKoi() {
            var fileUpload = $("#files").get(0);
            var files = fileUpload.files;
            // Looping over all files and add it to FormData object  
            var fileData = new FormData();

            for (var i = 0; i < files.length; i++) {  
                fileData.append(files[i].name, files[i]);  
            }  
              
            // Adding one more key to FormData object  
            fileData.append('Size', $('#Size').val());
            fileData.append('HeathyStatus', $('#HeathyStatus').val());
            fileData.append('Description', $('#Description').val());
            fileData.append('KoiID', @ViewBag.KoiID);


            $('#lblMessage_koi_size_fail').text("");

            $.ajax({
                type: "POST",
                url: "@Url.Action("AddDetail")",
                contentType: false, // Not to set any content header  
            processData: false,
            data: fileData,
            dataType: "Json",
            success: function(res) {
                switch (res.Status) {
                    case 2:
                        $('#lblMessage_koi_size_fail').text(res.Message);
                        break;
                    case 3:
                        $('#..').text(res.Message);
                        $('#password').focus();
                        break;
                    case 4:
                        break;
                    case 1:
                        alert(res.Message);
                        window.location.href = res.RedirectTo;
                        break;
                    case 0:
                        window.location.href = res.RedirectTo;
                        break;
                }
            }
        });
        }


    $(document).ready(function () {
        if (window.File && window.FileList && window.FileReader) {
            $("#files").on("change", function (e) {
                var files = e.target.files,
                    filesLength = files.length;
                for (var i = 0; i < filesLength; i++) {
                    var f = files[i]
                    var fileReader = new FileReader();
                    fileReader.onload = (function (e) {
                        var file = e.target;
                        $("<span class=\"pip\">" +
                            "<img class=\"imageThumb\" src=\"" + e.target.result + "\" title=\"" + file.name + "\"/>" +
                            "<br/><span class=\"remove\">X</span>" +
                            "</span>").insertAfter("#files");
                        $(".remove").click(function () {
                            $(this).parent(".pip").remove();
                        });
                    });
                    fileReader.readAsDataURL(f);
                }
            });
        } else {
            alert("Your browser doesn't support to File API")
        }
    });
</script> 