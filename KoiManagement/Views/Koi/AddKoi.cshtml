@model IEnumerable<KoiManagement.Models.Variety>

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Layout/KoiLayout.cshtml";
}

<div class="container" id="add-koi" >
        <h2 id="form-title">THÊM CÁ KOI MỚI</h2>
        <div class="">
            <div class="row">
                <div class="col-sm-6">
                    <input type="text" class="form-control" placeholder="Tên Cá Koi" id="KoiName" name="KoiName">
                    <label id="lblMessage_koi_name_fail" class="label-error"></label>
                </div>
                <div class="col-sm-6">
                    <select class="form-control" id="VarietyID" name="VarietyID">
                        <option value="0">Chủng Loại</option>
                        @foreach (var item in Model)
                        {
                            <option value="@item.VarietyID">@item.VarietyName</option>
                        }
                    </select>
                    <label id="lblMessage_koi_variety_fail" class="label-error"></label>
                </div>

            </div>
            <div class="row">
                <div class="col-sm-6">
                    <select class="form-control" id="Gender" name="Gender">
                        <option value="N">Giới Tính</option>
                        <option value="M">Đực</option>
                        <option value="F">Cái</option>
                    </select>
                </div>
                <div class="col-sm-6">
                    <input type="text" class="form-control" placeholder="Ngày Sinh" id="DoB" name="DoB" onfocus="(this.type='date')">
                    <label id=" lblmessage_dob_fail" class="label-error"></label>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <input type="text" class="form-control" placeholder="Chiều dài" id="Size" name="Size">
                    <label id="lblMessage_koi_size_fail" class="label-error"></label>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                        <input type="text" class="form-control" placeholder="Tính Cách" id="Temperament" name="Temperament">
                        <label id="lblMessage_temperament_fail" class="label-error"></label>
                    </div>
                </div>
                <div class="col-sm-6">
                    <input type="text" class="form-control" placeholder="Nguồn Gốc" id="Origin" name="Origin">
                    <label id="lblMessage_origin_fail" class="label-error"></label>
                </div>
            </div>

            <br />
            <div class="row">
                <div class="col-sm-12">
                    <input type="file" accept="image/png, image/jpeg, image/gif" name="file" id="file" class="img" onchange="loadFile(event)" />
                    <br />
                    <div><img id="imagePreview" src="~/Content/Image/Common/blank.jpg" alt="" /></div>
                    <script>
                        var loadFile = function (event) {
                            var output = document.getElementById('imagePreview');
                            imagePreview.src = URL.createObjectURL(event.target.files[0]);
                        };
                    </script>
                </div>
            </div>
            <div class="modal-footer">
                <button   id="btnAddKoi"  class="btn btn-default">Thêm mới</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Hủy</button>
            </div>
        </div>
  
</div>


<script type="text/javascript">

        $(document).ready(function () {
            $(function () {
                $("#KoiName").focus();
            });
        });

        $(document).keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == "13") {
                if (Validate()) {
                    AddKoi();
                } else {
                    return false;
                }
            }
        });
 

        $("#btnAddKoi").click(function () {
            if (Validate()) {
                AddKoi();
            } else {

                return false;
            }
        });
        function Validate() {
            //var username = $("#username").val();
            //var password = $("#password").val();
            //$("#lbl_username_fail").text("");
            //$("#lbl_password_fail").text("");
            //if (username == "") {
            //    $("#lbl_username_fail").text("Vui lòng nhập tên đăng nhập");
            //    $("#username").focus();
            //    return false;
            //} else if (password == "") {
            //    $("#errorMessage").text("");
            //    $("#lbl_password_fail").text("Vui lòng nhập mật khẩu");
            //    $("#password").focus();
            //    return false;
            //}
            return true;
        }

        function AddKoi() {
            var fileUpload = $("#file").get(0);
            var files = fileUpload.files;
            // Looping over all files and add it to FormData object  
            var fileData = new FormData();

            for (var i = 0; i < files.length; i++) {  
                fileData.append(files[i].name, files[i]);  
            }  
              
            // Adding one more key to FormData object  
            fileData.append('KoiName', $('#KoiName').val());
            fileData.append('VarietyID', $('#VarietyID').val());
            fileData.append('Size', $('#Size').val());
            fileData.append('Gender', $('#Gender').val());
            fileData.append('DoB', $('#DoB').val());
            fileData.append('Temperament', $('#Temperament').val());
            fileData.append('Origin', $('#Origin').val());

            $('#lblMessage_koi_name_fail').text("");
            $('#lblMessage_koi_variety_fail').text("");
            $('#lblMessage_koi_size_fail').text("");
            $('#lblmessage_dob_fail').text("");
            $('#lblMessage_temperament_fail').text("");
            $('#lblMessage_origin_fail').text("");
            $.ajax({
                type: "POST",
                url: "@Url.Action("AddKoi")",
                contentType: false, // Not to set any content header  
                processData: false,
                data: fileData,
                dataType: "Json",
                success: function(res) {
                    switch (res.Status) {
                    case 2:
                        $('#lblMessage_koi_name_fail').text(res.Message);
                        $('#username').focus();
                        break;
                    case 3:
                        $('#lbl_password_fail').text(res.Message);
                        $('#password').focus();
                        break;
                    case 4:
                        $('#errorMessage').text(res.Message);
                        $('#username').focus();
                        break;
                    case 1:
                        alert(res.Message);
                        window.location.href = res.RedirectTo;
                        break;
                    }
                }
            });
        }
</script>